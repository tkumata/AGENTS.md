---
name: rust-coding
description: Rust の CLI と Web サーバ開発、設計、テスト、エラー設計を支援する。Rust コードの実装、リファクタ、構成検討、cargo/clippy/fmt の運用、代表的クレート選定が必要なときに使う。
---

# Rust コーディング

## 前提

- AGENTS.md と GEMINI.md を必ず遵守する。

## 概要

Rust の CLI と Web サーバ開発における実装と設計を、最小の前提確認から進めるための指針を提供する。
既存プロジェクトの慣習とコードを最優先にし、必要な場合のみ最小限の追加仕様を提案する。

## 進め方

1. 対象を確認する。CLI か Web サーバか、または両方かを明確にする。
2. 入出力、エラー時の挙動、性能要件、非同期の要否、外部依存を確認する。
3. 既存コードの構成、モジュール分割、命名、エラーポリシーに合わせる。
4. 実装とテストの順で進め、`cargo fmt` と `cargo clippy` を前提にする。

## CLI の指針

- 引数解析は `clap` を基本とし、サブコマンドがある場合は階層を浅く保つ。
- 標準入出力の扱い、終了コード、エラーメッセージの形式を明確にする。
- 失敗時は短い診断メッセージと再現可能な入力例を添える。

## Web サーバの指針

- フレームワークは `axum` と `tokio` を基本とする。
- ルーティング、状態管理、エラー変換、ログ、タイムアウトを最初に整理する。
- 返却 JSON の型とエラー形式を先に定義し、ハンドラから漏れなく返す。

## エラー設計

- バイナリ用途は `anyhow`、ライブラリ用途は `thiserror` を基本とする。
- エラー型は最小限にし、境界で変換する。
- 表示向け文言とデバッグ向け文言を分ける。

## テスト

- 小さな関数は単体テスト、入出力や I/O を含むものは統合テストを基本とする。
- `#[cfg(test)]` と `tests/` の使い分けを明確にする。

## 参照

詳細な実装レシピと最小テンプレートは `references/rust-workflows.md` を開いて確認する。
